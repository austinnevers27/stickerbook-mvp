<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Stickerbook – Create Account</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="css/stickerbook.css">
  <style>
    /* ========== PAGE-SPECIFIC STYLES ========== */
    
    /* Fix browser autofill yellow background */
    input:-webkit-autofill,
    input:-webkit-autofill:hover,
    input:-webkit-autofill:focus,
    input:-webkit-autofill:active {
      -webkit-box-shadow: 0 0 0 1000px white inset !important;
      -webkit-text-fill-color: var(--color-text-primary) !important;
      transition: background-color 5000s ease-in-out 0s;
    }

    /* Turquoise accent for user flow */
    .user-flow .field-label {
      color: var(--color-turquoise);
    }

    .user-flow .field-input:focus {
      border-color: var(--color-turquoise);
      box-shadow: 0 0 0 3px rgba(20, 184, 166, 0.15);
    }

    .user-flow .terms-row a {
      color: var(--color-turquoise);
    }

    .user-flow .terms-row a:hover {
      color: var(--color-turquoise-dark);
    }

    .user-flow .password-rule.met {
      color: var(--color-turquoise);
    }

    .user-flow .terms-row input[type="checkbox"] {
      accent-color: var(--color-turquoise);
    }

    /* Tighter form spacing */
    .form-tight {
      gap: 10px;
    }

    .form-tight .field {
      margin-bottom: 0;
    }

    /* Title area */
    .title-area {
      text-align: center;
      margin-bottom: 8px;
    }

    .title-area .screen-title {
      margin-bottom: 2px;
    }

    .title-area .screen-subtitle {
      margin-bottom: 0;
    }

    /* Location row - all centered */
    .location-row {
      display: flex;
      gap: 8px;
    }

    .location-row .field-input {
      min-width: 0;
      text-align: center;
    }

    .location-row .field-input--city {
      flex: 2;
    }

    .location-row .field-input--state {
      flex: 1;
    }

    .location-row .field-input--zip {
      flex: 1;
    }

    /* Password rules - horizontal, matching creator style */
    .user-flow .password-rules {
      display: flex !important;
      flex-direction: row !important;
      flex-wrap: wrap;
      justify-content: center;
      gap: 4px 14px;
      margin-top: 4px;
    }

    .user-flow .password-rule {
      font-size: 9px;
      white-space: nowrap;
    }

    /* Terms row */
    .terms-row {
      margin-top: 6px;
    }

    /* CTA row */
    .cta-row {
      margin-top: 12px;
    }

    /* Field error */
    .field-error {
      min-height: 0;
    }

    .field-error:not(:empty) {
      margin-top: 4px;
    }

    /* Parent consent - appears dynamically for 13-17 */
    .parent-consent-row {
      display: flex;
      align-items: flex-start;
      gap: 8px;
      margin-top: 6px;
      opacity: 0;
      max-height: 0;
      overflow: hidden;
      transition: opacity 0.25s ease, max-height 0.25s ease;
    }

    .parent-consent-row.visible {
      opacity: 1;
      max-height: 50px;
    }

    .parent-consent-row input[type="checkbox"] {
      margin-top: 2px;
      flex-shrink: 0;
      accent-color: var(--color-turquoise);
    }

    .parent-consent-row label {
      font-size: 11px;
      line-height: 1.4;
      color: var(--color-text-secondary);
    }

    /* Skip button in header */
    .app-header__skip {
      position: absolute;
      right: 0;
      top: 50%;
      transform: translateY(-50%);
      background: transparent;
      border: 1px solid var(--color-border);
      color: var(--color-text-muted);
      padding: 6px 12px;
      font-size: 10px;
      font-weight: 600;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      border-radius: var(--radius-pill);
      cursor: pointer;
      font-family: var(--font-primary);
      transition: border-color 0.15s ease, color 0.15s ease;
    }

    .app-header__skip:hover {
      border-color: var(--color-border-strong);
      color: var(--color-text-secondary);
    }
  </style>
</head>
<body>
  <div class="app-shell user-flow">
    <div class="phone-frame">
      <div class="phone-inner">
        <div class="shell-inner">
          
          <!-- Header -->
          <header class="app-header app-header--with-nav">
            <button class="app-header__back" onclick="window.location.href='index.html'">
              <span>←</span> Back
            </button>
            <span class="app-header__title">Stickerbook</span>
            <div class="app-header__accent"></div>
            <button class="app-header__skip" id="skip-btn">Skip</button>
          </header>

          <!-- Title -->
          <div class="title-area">
            <h1 class="screen-title">Create Your Account</h1>
            <p class="screen-subtitle">Just a few quick things, then we'll get to the fun part.</p>
          </div>

          <!-- Form -->
          <form class="form form-tight" id="account-form" novalidate>
            
            <!-- Name -->
            <div class="field">
              <label class="field-label" for="name">Name</label>
              <input 
                type="text" 
                id="name" 
                class="field-input" 
                placeholder="What should we call you?"
                autocomplete="given-name"
                required
              />
              <div class="field-error" id="name-error"></div>
            </div>

            <!-- Date of Birth -->
            <div class="field">
              <label class="field-label">Date of Birth</label>
              <div class="dob-row">
                <input 
                  type="text" 
                  id="dob-month" 
                  class="field-input" 
                  placeholder="MM"
                  maxlength="2"
                  inputmode="numeric"
                  autocomplete="bday-month"
                  required
                />
                <input 
                  type="text" 
                  id="dob-day" 
                  class="field-input" 
                  placeholder="DD"
                  maxlength="2"
                  inputmode="numeric"
                  autocomplete="bday-day"
                  required
                />
                <input 
                  type="text" 
                  id="dob-year" 
                  class="field-input" 
                  placeholder="YYYY"
                  maxlength="4"
                  inputmode="numeric"
                  autocomplete="bday-year"
                  required
                />
              </div>
              <div class="parent-consent-row" id="parent-consent-row">
                <input type="checkbox" id="parent-consent" />
                <label for="parent-consent">My parent or guardian knows I'm creating this account</label>
              </div>
              <div class="field-error" id="dob-error"></div>
            </div>

            <!-- Location -->
            <div class="field">
              <label class="field-label">Location</label>
              <div class="location-row">
                <input 
                  type="text" 
                  id="city" 
                  class="field-input field-input--city" 
                  placeholder="City"
                  autocomplete="address-level2"
                  required
                />
                <input 
                  type="text" 
                  id="state" 
                  class="field-input field-input--state" 
                  placeholder="State"
                  maxlength="2"
                  autocomplete="address-level1"
                  required
                />
                <input 
                  type="text" 
                  id="zip" 
                  class="field-input field-input--zip" 
                  placeholder="Zip"
                  maxlength="5"
                  inputmode="numeric"
                  autocomplete="postal-code"
                  required
                />
              </div>
              <div class="field-error" id="location-error"></div>
            </div>

            <!-- Email -->
            <div class="field">
              <label class="field-label" for="email">Email</label>
              <input 
                type="email" 
                id="email" 
                class="field-input" 
                placeholder="you@example.com"
                autocomplete="email"
                required
              />
              <div class="field-error" id="email-error"></div>
            </div>

            <!-- Password -->
            <div class="field">
              <label class="field-label" for="password">Password</label>
              <input 
                type="password" 
                id="password" 
                class="field-input" 
                placeholder="Create a password"
                autocomplete="new-password"
                required
              />
              <div class="password-rules">
                <div class="password-rule" id="rule-length">8+ characters</div>
                <div class="password-rule" id="rule-upper">1+ uppercase</div>
                <div class="password-rule" id="rule-lower">1+ lowercase</div>
                <div class="password-rule" id="rule-number">1+ number</div>
              </div>
              <div class="field-error" id="password-error"></div>
            </div>

            <!-- Terms -->
            <div class="terms-row">
              <input type="checkbox" id="terms" required />
              <label for="terms">
                I agree to the <a href="#">Terms of Service</a> and <a href="#">Privacy Policy</a>
              </label>
            </div>
            <div class="field-error" id="terms-error"></div>

            <!-- Submit -->
            <div class="cta-row">
              <button type="submit" class="btn btn-primary" id="submit-btn">
                Continue
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>

  <script>
    // DOM elements
    const form = document.getElementById('account-form');
    const skipBtn = document.getElementById('skip-btn');
    
    const nameInput = document.getElementById('name');
    const dobMonth = document.getElementById('dob-month');
    const dobDay = document.getElementById('dob-day');
    const dobYear = document.getElementById('dob-year');
    const parentConsentRow = document.getElementById('parent-consent-row');
    const parentConsentCheckbox = document.getElementById('parent-consent');
    const cityInput = document.getElementById('city');
    const stateInput = document.getElementById('state');
    const zipInput = document.getElementById('zip');
    const emailInput = document.getElementById('email');
    const passwordInput = document.getElementById('password');
    const termsCheckbox = document.getElementById('terms');

    const nameError = document.getElementById('name-error');
    const dobError = document.getElementById('dob-error');
    const locationError = document.getElementById('location-error');
    const emailError = document.getElementById('email-error');
    const passwordError = document.getElementById('password-error');
    const termsError = document.getElementById('terms-error');

    const ruleLength = document.getElementById('rule-length');
    const ruleUpper = document.getElementById('rule-upper');
    const ruleLower = document.getElementById('rule-lower');
    const ruleNumber = document.getElementById('rule-number');

    // State
    let isMinor = false;

    // Calculate age helper
    function calculateAge(month, day, year) {
      const today = new Date();
      const birthDate = new Date(year, month - 1, day);
      let age = today.getFullYear() - birthDate.getFullYear();
      const monthDiff = today.getMonth() - birthDate.getMonth();
      
      if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birthDate.getDate())) {
        age--;
      }
      
      return age;
    }

    // Check age and show parent consent if 13-17
    function checkAgeAndShowConsent() {
      const m = parseInt(dobMonth.value, 10);
      const d = parseInt(dobDay.value, 10);
      const y = parseInt(dobYear.value, 10);

      if (isNaN(m) || isNaN(d) || isNaN(y) || dobYear.value.length < 4) {
        parentConsentRow.classList.remove('visible');
        return;
      }

      if (m < 1 || m > 12 || d < 1 || d > 31 || y < 1900 || y > new Date().getFullYear()) {
        parentConsentRow.classList.remove('visible');
        return;
      }

      const age = calculateAge(m, d, y);
      
      if (age >= 13 && age < 18) {
        isMinor = true;
        parentConsentRow.classList.add('visible');
      } else {
        isMinor = false;
        parentConsentRow.classList.remove('visible');
      }
    }

    // Auto-tab for DOB fields
    function autoTab(current, next, maxLength) {
      current.addEventListener('input', (e) => {
        e.target.value = e.target.value.replace(/\D/g, '');
        
        if (e.target.value.length >= maxLength && next) {
          next.focus();
        }

        if (current === dobYear && e.target.value.length === 4) {
          checkAgeAndShowConsent();
        }
      });
    }

    autoTab(dobMonth, dobDay, 2);
    autoTab(dobDay, dobYear, 2);
    autoTab(dobYear, null, 4);

    // Also check on blur
    dobMonth.addEventListener('blur', checkAgeAndShowConsent);
    dobDay.addEventListener('blur', checkAgeAndShowConsent);
    dobYear.addEventListener('blur', checkAgeAndShowConsent);

    // Zip field: only numbers
    zipInput.addEventListener('input', (e) => {
      e.target.value = e.target.value.replace(/\D/g, '');
    });

    // State field: force uppercase, letters only
    stateInput.addEventListener('input', (e) => {
      e.target.value = e.target.value.toUpperCase().replace(/[^A-Z]/g, '');
    });

    // Password validation - live update
    passwordInput.addEventListener('input', () => {
      const val = passwordInput.value;
      
      ruleLength.classList.toggle('met', val.length >= 8);
      ruleUpper.classList.toggle('met', /[A-Z]/.test(val));
      ruleLower.classList.toggle('met', /[a-z]/.test(val));
      ruleNumber.classList.toggle('met', /[0-9]/.test(val));
    });

    // Clear errors on input
    nameInput.addEventListener('input', () => { nameError.textContent = ''; });
    dobMonth.addEventListener('input', () => { dobError.textContent = ''; });
    dobDay.addEventListener('input', () => { dobError.textContent = ''; });
    dobYear.addEventListener('input', () => { dobError.textContent = ''; });
    cityInput.addEventListener('input', () => { locationError.textContent = ''; });
    stateInput.addEventListener('input', () => { locationError.textContent = ''; });
    zipInput.addEventListener('input', () => { locationError.textContent = ''; });
    emailInput.addEventListener('input', () => { emailError.textContent = ''; });
    passwordInput.addEventListener('input', () => { passwordError.textContent = ''; });
    termsCheckbox.addEventListener('change', () => { termsError.textContent = ''; });

    // Validation helpers
    function isValidEmail(email) {
      return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
    }

    function isValidPassword(password) {
      return (
        password.length >= 8 &&
        /[A-Z]/.test(password) &&
        /[a-z]/.test(password) &&
        /[0-9]/.test(password)
      );
    }

    function isValidDOB(month, day, year) {
      const m = parseInt(month, 10);
      const d = parseInt(day, 10);
      const y = parseInt(year, 10);
      
      if (isNaN(m) || isNaN(d) || isNaN(y)) return { valid: false, reason: 'incomplete' };
      if (m < 1 || m > 12) return { valid: false, reason: 'invalid' };
      if (d < 1 || d > 31) return { valid: false, reason: 'invalid' };
      if (y < 1900 || y > new Date().getFullYear()) return { valid: false, reason: 'invalid' };
      
      const testDate = new Date(y, m - 1, d);
      if (testDate.getMonth() !== m - 1) return { valid: false, reason: 'invalid' };
      
      const age = calculateAge(m, d, y);
      if (age < 13) return { valid: false, reason: 'underage' };
      
      return { valid: true };
    }

    // Form submission
    form.addEventListener('submit', (e) => {
      e.preventDefault();
      
      let hasError = false;
      
      // Validate name
      if (!nameInput.value.trim()) {
        nameError.textContent = 'Please enter your name.';
        hasError = true;
      }
      
      // Validate DOB
      const dobResult = isValidDOB(dobMonth.value, dobDay.value, dobYear.value);
      if (!dobResult.valid) {
        if (dobResult.reason === 'incomplete') {
          dobError.textContent = 'Please enter your complete date of birth.';
        } else if (dobResult.reason === 'underage') {
          dobError.textContent = 'You must be at least 13 years old to use Stickerbook.';
        } else {
          dobError.textContent = 'Please enter a valid date of birth.';
        }
        hasError = true;
      }

      // If minor, check parent consent
      if (isMinor && !parentConsentCheckbox.checked) {
        dobError.textContent = 'Please confirm your parent or guardian knows about this account.';
        hasError = true;
      }
      
      // Validate location
      if (!cityInput.value.trim() || !stateInput.value.trim() || !zipInput.value.trim()) {
        locationError.textContent = 'Please enter your city, state, and zip code.';
        hasError = true;
      } else if (zipInput.value.length !== 5) {
        locationError.textContent = 'Please enter a valid 5-digit zip code.';
        hasError = true;
      } else if (stateInput.value.length !== 2) {
        locationError.textContent = 'Please enter a valid 2-letter state code.';
        hasError = true;
      }
      
      // Validate email
      if (!emailInput.value.trim()) {
        emailError.textContent = 'Please enter your email address.';
        hasError = true;
      } else if (!isValidEmail(emailInput.value)) {
        emailError.textContent = 'Please enter a valid email address.';
        hasError = true;
      }
      
      // Validate password
      if (!passwordInput.value) {
        passwordError.textContent = 'Please create a password.';
        hasError = true;
      } else if (!isValidPassword(passwordInput.value)) {
        passwordError.textContent = 'Password doesn\'t meet all requirements.';
        hasError = true;
      }
      
      // Validate terms
      if (!termsCheckbox.checked) {
        termsError.textContent = 'You must agree to the terms to continue.';
        hasError = true;
      }
      
      if (hasError) return;
      
      // Save to localStorage
      const userData = {
        name: nameInput.value.trim(),
        isMinor: isMinor,
        dob: {
          month: dobMonth.value,
          day: dobDay.value,
          year: dobYear.value
        },
        location: {
          city: cityInput.value.trim(),
          state: stateInput.value.trim().toUpperCase(),
          zip: zipInput.value.trim()
        },
        email: emailInput.value.trim()
      };
      
      localStorage.setItem('stickerbook_user', JSON.stringify(userData));
      localStorage.setItem('stickerbook_user_name', userData.name);
      localStorage.setItem('stickerbook_is_minor', isMinor.toString());
      
      // Navigate to interests picker
      window.location.href = 'interests.html';
    });

    // Skip button (developer tool)
    skipBtn.addEventListener('click', () => {
      window.location.href = 'interests.html?source=account';
    });
  </script>
</body>
</html>