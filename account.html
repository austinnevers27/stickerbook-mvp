<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Stickerbook â€“ Create Account</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="css/stickerbook.css">
</head>
<body>
  <div class="app-shell">
    <div class="phone-frame">
      <div class="phone-inner">
        <div class="shell-inner">
          <!-- Header with logo and skip button -->
          <div class="top-row">
            <div class="logo-group" style="align-items: flex-start;">
              <div class="logo-mark">STICKERBOOK</div>
              <div class="logo-accent"></div>
            </div>
            <button class="btn-skip" id="skip-btn">Skip</button>
          </div>

          <!-- Title -->
          <h1 class="screen-title text-center">Create your account</h1>
          <p class="screen-subtitle text-center">
            Just a few quick things, then we'll get to the fun part.
          </p>

          <!-- Form -->
          <form class="form" id="account-form" novalidate>
            <!-- Name -->
            <div class="field">
              <label class="field-label" for="name">Name</label>
              <input 
                type="text" 
                id="name" 
                class="field-input" 
                placeholder="What should we call you?"
                autocomplete="given-name"
                required
              />
              <div class="field-error" id="name-error"></div>
            </div>

            <!-- Date of Birth -->
            <div class="field">
              <label class="field-label">Date of Birth</label>
              <div class="dob-row">
                <input 
                  type="text" 
                  id="dob-month" 
                  class="field-input" 
                  placeholder="MM"
                  maxlength="2"
                  inputmode="numeric"
                  autocomplete="bday-month"
                  required
                />
                <input 
                  type="text" 
                  id="dob-day" 
                  class="field-input" 
                  placeholder="DD"
                  maxlength="2"
                  inputmode="numeric"
                  autocomplete="bday-day"
                  required
                />
                <input 
                  type="text" 
                  id="dob-year" 
                  class="field-input" 
                  placeholder="YYYY"
                  maxlength="4"
                  inputmode="numeric"
                  autocomplete="bday-year"
                  required
                />
              </div>
              <div class="field-error" id="dob-error"></div>
            </div>

            <!-- Location -->
            <div class="field">
              <label class="field-label">Location</label>
              <div class="location-row">
                <input 
                  type="text" 
                  id="city" 
                  class="field-input field-input--city" 
                  placeholder="City"
                  autocomplete="address-level2"
                  required
                />
                <input 
                  type="text" 
                  id="state" 
                  class="field-input field-input--state" 
                  placeholder="ST"
                  maxlength="2"
                  autocomplete="address-level1"
                  required
                />
                <input 
                  type="text" 
                  id="zip" 
                  class="field-input field-input--zip" 
                  placeholder="Zip"
                  maxlength="5"
                  inputmode="numeric"
                  autocomplete="postal-code"
                  required
                />
              </div>
              <div class="field-error" id="location-error"></div>
            </div>

            <!-- Email -->
            <div class="field">
              <label class="field-label" for="email">Email</label>
              <input 
                type="email" 
                id="email" 
                class="field-input" 
                placeholder="you@example.com"
                autocomplete="email"
                required
              />
              <div class="field-error" id="email-error"></div>
            </div>

            <!-- Password -->
            <div class="field">
              <label class="field-label" for="password">Password</label>
              <input 
                type="password" 
                id="password" 
                class="field-input" 
                placeholder="Create a password"
                autocomplete="new-password"
                required
              />
              <div class="password-rules">
                <div class="password-rule" id="rule-length">At least 8 characters</div>
                <div class="password-rule" id="rule-upper">One uppercase letter</div>
                <div class="password-rule" id="rule-lower">One lowercase letter</div>
                <div class="password-rule" id="rule-number">One number</div>
              </div>
              <div class="field-error" id="password-error"></div>
            </div>

            <!-- Terms -->
            <div class="terms-row">
              <input type="checkbox" id="terms" required />
              <label for="terms">
                I agree to the <a href="#">Terms of Service</a> and <a href="#">Privacy Policy</a>
              </label>
            </div>
            <div class="field-error" id="terms-error"></div>

            <!-- Submit -->
            <div class="cta-row">
              <button type="submit" class="btn btn-primary" id="submit-btn">
                Continue
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>

  <script>
    // DOM elements
    const form = document.getElementById('account-form');
    const skipBtn = document.getElementById('skip-btn');
    
    const nameInput = document.getElementById('name');
    const dobMonth = document.getElementById('dob-month');
    const dobDay = document.getElementById('dob-day');
    const dobYear = document.getElementById('dob-year');
    const cityInput = document.getElementById('city');
    const stateInput = document.getElementById('state');
    const zipInput = document.getElementById('zip');
    const emailInput = document.getElementById('email');
    const passwordInput = document.getElementById('password');
    const termsCheckbox = document.getElementById('terms');

    const nameError = document.getElementById('name-error');
    const dobError = document.getElementById('dob-error');
    const locationError = document.getElementById('location-error');
    const emailError = document.getElementById('email-error');
    const passwordError = document.getElementById('password-error');
    const termsError = document.getElementById('terms-error');

    const ruleLength = document.getElementById('rule-length');
    const ruleUpper = document.getElementById('rule-upper');
    const ruleLower = document.getElementById('rule-lower');
    const ruleNumber = document.getElementById('rule-number');

    // Auto-tab for DOB fields
    function autoTab(current, next, maxLength) {
      current.addEventListener('input', (e) => {
        // Only allow numbers
        e.target.value = e.target.value.replace(/\D/g, '');
        
        if (e.target.value.length >= maxLength && next) {
          next.focus();
        }
      });
    }

    autoTab(dobMonth, dobDay, 2);
    autoTab(dobDay, dobYear, 2);
    autoTab(dobYear, null, 4);

    // Auto-tab for zip (just filter to numbers)
    zipInput.addEventListener('input', (e) => {
      e.target.value = e.target.value.replace(/\D/g, '');
    });

    // State field: force uppercase
    stateInput.addEventListener('input', (e) => {
      e.target.value = e.target.value.toUpperCase().replace(/[^A-Z]/g, '');
    });

    // Password validation - live update
    passwordInput.addEventListener('input', () => {
      const val = passwordInput.value;
      
      // Length check
      if (val.length >= 8) {
        ruleLength.classList.add('met');
      } else {
        ruleLength.classList.remove('met');
      }
      
      // Uppercase check
      if (/[A-Z]/.test(val)) {
        ruleUpper.classList.add('met');
      } else {
        ruleUpper.classList.remove('met');
      }
      
      // Lowercase check
      if (/[a-z]/.test(val)) {
        ruleLower.classList.add('met');
      } else {
        ruleLower.classList.remove('met');
      }
      
      // Number check
      if (/[0-9]/.test(val)) {
        ruleNumber.classList.add('met');
      } else {
        ruleNumber.classList.remove('met');
      }
    });

    // Clear errors on input
    nameInput.addEventListener('input', () => { nameError.textContent = ''; });
    dobMonth.addEventListener('input', () => { dobError.textContent = ''; });
    dobDay.addEventListener('input', () => { dobError.textContent = ''; });
    dobYear.addEventListener('input', () => { dobError.textContent = ''; });
    cityInput.addEventListener('input', () => { locationError.textContent = ''; });
    stateInput.addEventListener('input', () => { locationError.textContent = ''; });
    zipInput.addEventListener('input', () => { locationError.textContent = ''; });
    emailInput.addEventListener('input', () => { emailError.textContent = ''; });
    passwordInput.addEventListener('input', () => { passwordError.textContent = ''; });
    termsCheckbox.addEventListener('change', () => { termsError.textContent = ''; });

    // Validation helpers
    function isValidEmail(email) {
      return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
    }

    function isValidPassword(password) {
      return (
        password.length >= 8 &&
        /[A-Z]/.test(password) &&
        /[a-z]/.test(password) &&
        /[0-9]/.test(password)
      );
    }

    function calculateAge(month, day, year) {
      const today = new Date();
      const birthDate = new Date(year, month - 1, day);
      let age = today.getFullYear() - birthDate.getFullYear();
      const monthDiff = today.getMonth() - birthDate.getMonth();
      
      if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birthDate.getDate())) {
        age--;
      }
      
      return age;
    }

    function isValidDOB(month, day, year) {
      const m = parseInt(month, 10);
      const d = parseInt(day, 10);
      const y = parseInt(year, 10);
      
      if (isNaN(m) || isNaN(d) || isNaN(y)) return { valid: false, reason: 'incomplete' };
      if (m < 1 || m > 12) return { valid: false, reason: 'invalid' };
      if (d < 1 || d > 31) return { valid: false, reason: 'invalid' };
      if (y < 1900 || y > new Date().getFullYear()) return { valid: false, reason: 'invalid' };
      
      // Check if date actually exists
      const testDate = new Date(y, m - 1, d);
      if (testDate.getMonth() !== m - 1) return { valid: false, reason: 'invalid' };
      
      // Check age
      const age = calculateAge(m, d, y);
      if (age < 13) return { valid: false, reason: 'underage' };
      
      return { valid: true };
    }

    // Form submission
    form.addEventListener('submit', (e) => {
      e.preventDefault();
      
      let hasError = false;
      
      // Validate name
      if (!nameInput.value.trim()) {
        nameError.textContent = 'Please enter your name.';
        hasError = true;
      }
      
      // Validate DOB
      const dobResult = isValidDOB(dobMonth.value, dobDay.value, dobYear.value);
      if (!dobResult.valid) {
        if (dobResult.reason === 'incomplete') {
          dobError.textContent = 'Please enter your complete date of birth.';
        } else if (dobResult.reason === 'underage') {
          dobError.textContent = 'You must be at least 13 years old to use Stickerbook.';
        } else {
          dobError.textContent = 'Please enter a valid date of birth.';
        }
        hasError = true;
      }
      
      // Validate location
      if (!cityInput.value.trim() || !stateInput.value.trim() || !zipInput.value.trim()) {
        locationError.textContent = 'Please enter your city, state, and zip code.';
        hasError = true;
      } else if (zipInput.value.length !== 5) {
        locationError.textContent = 'Please enter a valid 5-digit zip code.';
        hasError = true;
      }
      
      // Validate email
      if (!emailInput.value.trim()) {
        emailError.textContent = 'Please enter your email address.';
        hasError = true;
      } else if (!isValidEmail(emailInput.value)) {
        emailError.textContent = 'Please enter a valid email address.';
        hasError = true;
      }
      
      // Validate password
      if (!passwordInput.value) {
        passwordError.textContent = 'Please create a password.';
        hasError = true;
      } else if (!isValidPassword(passwordInput.value)) {
        passwordError.textContent = 'Password doesn\'t meet all requirements.';
        hasError = true;
      }
      
      // Validate terms
      if (!termsCheckbox.checked) {
        termsError.textContent = 'You must agree to the terms to continue.';
        hasError = true;
      }
      
      if (hasError) return;
      
      // Save to localStorage (for MVP - will be backend later)
      const userData = {
        name: nameInput.value.trim(),
        dob: {
          month: dobMonth.value,
          day: dobDay.value,
          year: dobYear.value
        },
        location: {
          city: cityInput.value.trim(),
          state: stateInput.value.trim().toUpperCase(),
          zip: zipInput.value.trim()
        },
        email: emailInput.value.trim()
        // Note: Never store passwords in localStorage in production!
      };
      
      localStorage.setItem('stickerbook_user', JSON.stringify(userData));
      
      // Navigate to background selection
      window.location.href = 'background.html';
    });

    // Skip button (developer tool)
    skipBtn.addEventListener('click', () => {
      window.location.href = 'background.html';
    });
  </script>
</body>
</html>