<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Stickerbook ‚Äì Creator Account</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="css/stickerbook.css">
  <style>
    /* ========== PAGE-SPECIFIC STYLES ========== */
    
    /* Fix browser autofill yellow background */
    input:-webkit-autofill,
    input:-webkit-autofill:hover,
    input:-webkit-autofill:focus,
    input:-webkit-autofill:active {
      -webkit-box-shadow: 0 0 0 1000px white inset !important;
      -webkit-text-fill-color: var(--color-text-primary) !important;
      transition: background-color 5000s ease-in-out 0s;
    }

    /* Purple accent overrides for creator flow */
    .creator-flow .field-label {
      color: var(--color-purple);
    }

    .creator-flow .field-input:focus {
      border-color: var(--color-purple);
      box-shadow: 0 0 0 3px rgba(109, 40, 217, 0.15);
    }

    .creator-flow .field-select:focus {
      border-color: var(--color-purple);
      box-shadow: 0 0 0 3px rgba(109, 40, 217, 0.15);
    }

    .creator-flow .terms-row a {
      color: var(--color-purple);
    }

    .creator-flow .terms-row a:hover {
      color: var(--color-purple-dark);
    }

    .creator-flow .password-rule.met {
      color: var(--color-purple);
    }

    .creator-flow .terms-row input[type="checkbox"] {
      accent-color: var(--color-purple);
    }

    /* Tighter form spacing */
    .form-tight {
      gap: 8px;
    }

    .form-tight .field {
      margin-bottom: 0;
    }

    /* Header layout */
    .header-row {
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      margin-bottom: 10px;
    }

    .back-btn {
      position: absolute;
      left: 0;
      top: 50%;
      transform: translateY(-50%);
      background: none;
      border: none;
      font-size: 11px;
      color: var(--color-text-muted);
      cursor: pointer;
      font-family: var(--font-primary);
      display: flex;
      align-items: center;
      gap: 4px;
    }

    .back-btn:hover {
      color: var(--color-text-secondary);
    }

    .logo-centered {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 4px;
    }

    .logo-centered .logo-mark {
      font-size: 12px;
    }

    /* Title area - tighter */
    .title-area {
      text-align: center;
      margin-bottom: 6px;
    }

    .title-area .screen-title {
      margin-bottom: 2px;
    }

    .title-area .screen-subtitle {
      margin-bottom: 0;
    }

    /* Section dividers - tighter */
    .section-divider {
      display: flex;
      align-items: center;
      gap: 10px;
      margin: 10px 0 6px;
    }

    .section-divider-label {
      font-size: 9px;
      font-weight: 700;
      letter-spacing: 0.1em;
      text-transform: uppercase;
      color: var(--color-purple);
      white-space: nowrap;
    }

    .section-divider-line {
      flex: 1;
      height: 1px;
      background: var(--color-border);
    }

    /* Profile photo - compact */
    .profile-upload {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 4px;
      margin-bottom: 6px;
    }

    .profile-preview {
      width: 72px;
      height: 72px;
      border-radius: 50%;
      background: var(--color-canvas-subtle);
      border: 2px dashed var(--color-border);
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
      cursor: pointer;
      transition: border-color 0.15s ease;
      position: relative;
    }

    .profile-preview:hover {
      border-color: var(--color-purple);
    }

    .profile-preview.has-image {
      border-style: solid;
    }

    .profile-preview img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .profile-preview-placeholder {
      font-size: 24px;
      color: var(--color-text-muted);
    }

    .profile-upload-btn {
      font-size: 11px;
      font-weight: 600;
      color: var(--color-purple);
      background: none;
      border: none;
      cursor: pointer;
      font-family: var(--font-primary);
      padding: 0;
    }

    .profile-upload-btn:hover {
      color: var(--color-purple-dark);
    }

    #profile-input {
      display: none;
    }

    /* ========== CROP MODAL ========== */
    .crop-modal {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.95);
      z-index: 1000;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.25s ease, visibility 0.25s ease;
    }

    .crop-modal.visible {
      opacity: 1;
      visibility: visible;
    }

    .crop-modal-header {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      padding: 16px 20px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      z-index: 10;
    }

    .crop-modal-title {
      font-size: 14px;
      font-weight: 600;
      color: white;
      letter-spacing: 0.02em;
    }

    .crop-modal-cancel {
      background: none;
      border: none;
      color: rgba(255, 255, 255, 0.7);
      font-size: 13px;
      cursor: pointer;
      font-family: var(--font-primary);
      padding: 8px 12px;
    }

    .crop-modal-cancel:hover {
      color: white;
    }

    .crop-container {
      position: relative;
      width: 280px;
      height: 280px;
      overflow: hidden;
      touch-action: none;
    }

    .crop-image {
      position: absolute;
      transform-origin: 0 0;
      cursor: grab;
      user-select: none;
      -webkit-user-drag: none;
      z-index: 1;
    }

    .crop-image:active {
      cursor: grabbing;
    }

    .crop-overlay {
      position: absolute;
      inset: 0;
      pointer-events: none;
      z-index: 2;
    }

    .crop-overlay::before {
      content: "";
      position: absolute;
      inset: 0;
      background: rgba(0, 0, 0, 0.6);
      mask: radial-gradient(circle at center, transparent 140px, black 140px);
      -webkit-mask: radial-gradient(circle at center, transparent 140px, black 140px);
    }

    .crop-circle {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 280px;
      height: 280px;
      border-radius: 50%;
      border: 2px solid white;
      pointer-events: none;
    }

    .crop-hint {
      position: absolute;
      bottom: 100px;
      left: 0;
      right: 0;
      text-align: center;
      color: rgba(255, 255, 255, 0.6);
      font-size: 12px;
    }

    .crop-modal-footer {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      padding: 20px;
      display: flex;
      justify-content: center;
      z-index: 10;
    }

    .crop-confirm-btn {
      background: var(--gradient-primary);
      color: white;
      border: none;
      padding: 12px 40px;
      border-radius: var(--radius-pill);
      font-size: 12px;
      font-weight: 700;
      letter-spacing: 0.1em;
      text-transform: uppercase;
      cursor: pointer;
      box-shadow: var(--shadow-button);
      transition: transform 0.15s ease, box-shadow 0.15s ease;
      font-family: var(--font-primary);
    }

    .crop-confirm-btn:hover {
      transform: translateY(-1px);
      box-shadow: var(--shadow-button-hover);
    }

    .crop-confirm-btn:active {
      transform: translateY(1px);
    }

    .crop-zoom-controls {
      position: absolute;
      bottom: 80px;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      align-items: center;
      gap: 16px;
      z-index: 10;
    }

    .crop-zoom-btn {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.15);
      border: 1px solid rgba(255, 255, 255, 0.3);
      color: white;
      font-size: 18px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background 0.15s ease;
    }

    .crop-zoom-btn:hover {
      background: rgba(255, 255, 255, 0.25);
    }

    .crop-zoom-label {
      color: rgba(255, 255, 255, 0.7);
      font-size: 11px;
      min-width: 40px;
      text-align: center;
    }

    /* Turquoise helper text */
    .field-helper-focus {
      font-size: 11px;
      color: var(--color-turquoise);
      margin-top: 4px;
      opacity: 0;
      max-height: 0;
      overflow: hidden;
      transition: opacity 0.2s ease, max-height 0.2s ease;
      line-height: 1.4;
    }

    .field-helper-focus.visible {
      opacity: 1;
      max-height: 50px;
    }

    /* Parent consent - appears dynamically */
    .parent-consent-row {
      display: flex;
      align-items: flex-start;
      gap: 8px;
      margin-top: 6px;
      opacity: 0;
      max-height: 0;
      overflow: hidden;
      transition: opacity 0.25s ease, max-height 0.25s ease;
    }

    .parent-consent-row.visible {
      opacity: 1;
      max-height: 50px;
    }

    .parent-consent-row input[type="checkbox"] {
      margin-top: 2px;
      flex-shrink: 0;
      accent-color: var(--color-purple);
    }

    .parent-consent-row label {
      font-size: 11px;
      line-height: 1.4;
      color: var(--color-text-secondary);
    }

    /* Legal name layout - just First and Last */
    .legal-name-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 8px;
    }

    .legal-name-row .field-input {
      min-width: 0;
    }

    /* Address rows - combined street + apt */
    .address-row-combined {
      display: grid;
      grid-template-columns: 3fr 1fr;
      gap: 8px;
      margin-bottom: 8px;
    }

    .address-row-combined .field-input {
      min-width: 0;
    }

    .address-row-split {
      display: grid;
      grid-template-columns: 1fr 60px 80px;
      gap: 8px;
    }

    .address-row-split .field-input {
      min-width: 0;
    }

    .field-input--state {
      text-align: center;
      text-transform: uppercase;
    }

    .field-input--zip {
      text-align: center;
    }

    /* Password rules - horizontal (override CSS file with higher specificity) */
  .creator-flow .password-rules {
  display: flex !important;
  flex-direction: row !important;
  flex-wrap: wrap;
  justify-content: center;
  gap: 4px 14px;
  margin-top: 4px;
}

    .creator-flow .password-rule {
      font-size: 9px;
      white-space: nowrap;
    }

    /* Terms row - tighter */
    .terms-row {
      margin-top: 4px;
    }

    /* CTA row - tighter */
    .cta-row {
      margin-top: 10px;
    }

    /* Field error - tighter */
    .field-error {
      min-height: 0;
    }

    .field-error:not(:empty) {
      margin-top: 4px;
    }
  </style>
</head>
<body>
  <div class="app-shell creator-flow">
    <div class="phone-frame">
      <div class="phone-inner">
        <div class="shell-inner">
          
          <!-- Header -->
          <div class="header-row">
            <button class="back-btn" onclick="window.location.href='index.html'">
              <span>‚Üê</span> Back
            </button>
            <div class="logo-centered">
              <div class="logo-mark">STICKERBOOK</div>
              <div class="logo-accent"></div>
            </div>
          </div>

          <!-- Title -->
          <div class="title-area">
            <h1 class="screen-title">Create with Us</h1>
            <p class="screen-subtitle">Share your sticker art in the Sticker Shop</p>
          </div>

          <!-- Form -->
          <form class="form form-tight" id="creator-form" novalidate>
            
            <!-- ========== SECTION 1: ARTIST IDENTITY ========== -->
            <div class="section-divider">
              <span class="section-divider-label">Your Artist Identity</span>
              <span class="section-divider-line"></span>
            </div>

            <!-- Profile Photo -->
            <div class="profile-upload">
              <div class="profile-preview" id="profile-preview">
                <span class="profile-preview-placeholder">üì∑</span>
              </div>
              <button type="button" class="profile-upload-btn" id="profile-upload-btn">Add Profile Picture</button>
              <input type="file" id="profile-input" accept="image/*" />
            </div>
            <div class="field-error text-center" id="profile-error"></div>

            <!-- Artist Name -->
            <div class="field">
              <label class="field-label" for="display-name">Artist / Display Name</label>
              <input 
                type="text" 
                id="display-name" 
                class="field-input" 
                placeholder="How should we show your name?"
                maxlength="30"
                autocomplete="nickname"
              />
              <div class="field-error" id="display-name-error"></div>
            </div>

            <!-- Date of Birth -->
            <div class="field">
              <label class="field-label">Date of Birth</label>
              <div class="dob-row">
                <input 
                  type="text" 
                  id="dob-month" 
                  class="field-input" 
                  placeholder="MM"
                  maxlength="2"
                  inputmode="numeric"
                  autocomplete="bday-month"
                />
                <input 
                  type="text" 
                  id="dob-day" 
                  class="field-input" 
                  placeholder="DD"
                  maxlength="2"
                  inputmode="numeric"
                  autocomplete="bday-day"
                />
                <input 
                  type="text" 
                  id="dob-year" 
                  class="field-input" 
                  placeholder="YYYY"
                  maxlength="4"
                  inputmode="numeric"
                  autocomplete="bday-year"
                />
              </div>
              <p class="field-helper-focus" id="dob-helper">The creator program is open to all users age 13+. Monetization features only available for users age 18+.</p>
              <div class="parent-consent-row" id="parent-consent-row">
                <input type="checkbox" id="parent-consent" />
                <label for="parent-consent">My parent or guardian knows I'm creating this account</label>
              </div>
              <div class="field-error" id="dob-error"></div>
            </div>

            <!-- ========== SECTION 2: ACCOUNT ========== -->
            <div class="section-divider">
              <span class="section-divider-label">Account</span>
              <span class="section-divider-line"></span>
            </div>

            <!-- Legal Name -->
            <div class="field" id="legal-name-field">
              <label class="field-label">Legal Name</label>
              <div class="legal-name-row">
                <input 
                  type="text" 
                  id="legal-first" 
                  class="field-input" 
                  placeholder="First"
                  autocomplete="given-name"
                />
                <input 
                  type="text" 
                  id="legal-last" 
                  class="field-input" 
                  placeholder="Last"
                  autocomplete="family-name"
                />
              </div>
              <p class="field-helper-focus" id="legal-name-helper">Used for tax and payout purposes only ‚Äî never shown publicly</p>
              <div class="field-error" id="legal-name-error"></div>
            </div>

            <!-- Address -->
            <div class="field">
              <label class="field-label">Address</label>
              <div class="address-row-combined">
                <input 
                  type="text" 
                  id="street" 
                  class="field-input" 
                  placeholder="Street address"
                  autocomplete="address-line1"
                />
                <input 
                  type="text" 
                  id="apt" 
                  class="field-input" 
                  placeholder="Apt/Ste"
                  autocomplete="address-line2"
                />
              </div>
              <div class="address-row-split">
                <input 
                  type="text" 
                  id="city" 
                  class="field-input" 
                  placeholder="City"
                  autocomplete="address-level2"
                />
                <input 
                  type="text" 
                  id="state" 
                  class="field-input field-input--state" 
                  placeholder="ST"
                  maxlength="2"
                  autocomplete="address-level1"
                />
                <input 
                  type="text" 
                  id="zip" 
                  class="field-input field-input--zip" 
                  placeholder="ZIP"
                  maxlength="5"
                  inputmode="numeric"
                  autocomplete="postal-code"
                />
              </div>
              <div class="field-error" id="address-error"></div>
            </div>

            <!-- Email -->
            <div class="field">
              <label class="field-label" for="email">Email</label>
              <input 
                type="email" 
                id="email" 
                class="field-input" 
                placeholder="you@example.com"
                autocomplete="email"
              />
              <div class="field-error" id="email-error"></div>
            </div>

            <!-- Password -->
            <div class="field">
              <label class="field-label" for="password">Password</label>
              <input 
                type="password" 
                id="password" 
                class="field-input" 
                placeholder="Create a password"
                autocomplete="new-password"
              />
              <div class="password-rules">
                <div class="password-rule" id="rule-length">8+ characters</div>
                <div class="password-rule" id="rule-upper">1+ uppercase</div>
                <div class="password-rule" id="rule-lower">1+ lowercase</div>
                <div class="password-rule" id="rule-number">1+ number</div>
              </div>
              <div class="field-error" id="password-error"></div>
            </div>

            <!-- Terms -->
            <div class="terms-row">
              <input type="checkbox" id="terms" />
              <label for="terms">
                I agree to the <a href="#">Terms of Service</a> and <a href="#">Privacy Policy</a>
              </label>
            </div>
            <div class="field-error" id="terms-error"></div>

            <!-- Submit -->
            <div class="cta-row">
              <button type="submit" class="btn btn-primary" id="submit-btn">
                Create with Us
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>

  <!-- Crop Modal -->
  <div class="crop-modal" id="crop-modal">
    <div class="crop-modal-header">
      <button type="button" class="crop-modal-cancel" id="crop-cancel">Cancel</button>
      <span class="crop-modal-title">Adjust Photo</span>
      <div style="width: 60px;"></div>
    </div>
    
    <div class="crop-container" id="crop-container">
      <img class="crop-image" id="crop-image" src="" alt="Crop preview" />
      <div class="crop-overlay">
        <div class="crop-circle"></div>
      </div>
    </div>

    <div class="crop-zoom-controls">
      <button type="button" class="crop-zoom-btn" id="zoom-out">‚àí</button>
      <span class="crop-zoom-label" id="zoom-label">100%</span>
      <button type="button" class="crop-zoom-btn" id="zoom-in">+</button>
    </div>

    <div class="crop-hint">Drag to move ‚Ä¢ Pinch or use buttons to zoom</div>

    <div class="crop-modal-footer">
      <button type="button" class="crop-confirm-btn" id="crop-confirm">Apply</button>
    </div>
  </div>

  <script>
    // ============ DOM ELEMENTS ============
    const form = document.getElementById('creator-form');
    
    // Profile
    const profilePreview = document.getElementById('profile-preview');
    const profileInput = document.getElementById('profile-input');
    const profileUploadBtn = document.getElementById('profile-upload-btn');
    const profileError = document.getElementById('profile-error');
    
    // Crop modal
    const cropModal = document.getElementById('crop-modal');
    const cropContainer = document.getElementById('crop-container');
    const cropImage = document.getElementById('crop-image');
    const cropCancel = document.getElementById('crop-cancel');
    const cropConfirm = document.getElementById('crop-confirm');
    const zoomIn = document.getElementById('zoom-in');
    const zoomOut = document.getElementById('zoom-out');
    const zoomLabel = document.getElementById('zoom-label');
    
    // Artist identity
    const displayNameInput = document.getElementById('display-name');
    const dobMonth = document.getElementById('dob-month');
    const dobDay = document.getElementById('dob-day');
    const dobYear = document.getElementById('dob-year');
    const dobHelper = document.getElementById('dob-helper');
    const parentConsentRow = document.getElementById('parent-consent-row');
    const parentConsentCheckbox = document.getElementById('parent-consent');
    
    // Account
    const emailInput = document.getElementById('email');
    const passwordInput = document.getElementById('password');
    
    // Legal
    const legalFirst = document.getElementById('legal-first');
    const legalLast = document.getElementById('legal-last');
    const legalNameHelper = document.getElementById('legal-name-helper');
    const streetInput = document.getElementById('street');
    const aptInput = document.getElementById('apt');
    const cityInput = document.getElementById('city');
    const stateInput = document.getElementById('state');
    const zipInput = document.getElementById('zip');
    
    // Terms
    const termsCheckbox = document.getElementById('terms');
    
    // Error elements
    const displayNameError = document.getElementById('display-name-error');
    const dobError = document.getElementById('dob-error');
    const emailError = document.getElementById('email-error');
    const passwordError = document.getElementById('password-error');
    const legalNameError = document.getElementById('legal-name-error');
    const addressError = document.getElementById('address-error');
    const termsError = document.getElementById('terms-error');
    
    // Password rules
    const ruleLength = document.getElementById('rule-length');
    const ruleUpper = document.getElementById('rule-upper');
    const ruleLower = document.getElementById('rule-lower');
    const ruleNumber = document.getElementById('rule-number');

    // ============ STATE ============
    let profileImage = null;
    let croppedImageData = null;
    let isMinor = false;
    let userAge = null;

    // Crop state
    let originalImageData = null;
    let imgNaturalWidth = 0;
    let imgNaturalHeight = 0;
    let scale = 1;
    let minScale = 1;
    let maxScale = 4;
    let posX = 0;
    let posY = 0;
    let isDragging = false;
    let dragStartX = 0;
    let dragStartY = 0;
    let startPosX = 0;
    let startPosY = 0;

    // Pinch zoom state
    let initialPinchDistance = 0;
    let initialPinchScale = 1;

    // ============ PROFILE PHOTO ============
    profilePreview.addEventListener('click', () => profileInput.click());
    profileUploadBtn.addEventListener('click', () => profileInput.click());

    profileInput.addEventListener('change', (e) => {
      const file = e.target.files[0];
      if (file) {
        profileImage = file;
        const reader = new FileReader();
        reader.onload = (e) => {
          originalImageData = e.target.result;
          openCropModal(originalImageData);
        };
        reader.readAsDataURL(file);
        profileError.textContent = '';
      }
    });

    // ============ CROP MODAL ============
    function openCropModal(imageSrc) {
      cropImage.src = imageSrc;
      
      cropImage.onload = () => {
        imgNaturalWidth = cropImage.naturalWidth;
        imgNaturalHeight = cropImage.naturalHeight;
        
        // Calculate minimum scale to cover the crop circle (280px)
        const cropSize = 280;
        const scaleX = cropSize / imgNaturalWidth;
        const scaleY = cropSize / imgNaturalHeight;
        minScale = Math.max(scaleX, scaleY);
        maxScale = minScale * 4;
        scale = minScale;
        
        // Center the image
        posX = (cropSize - imgNaturalWidth * scale) / 2;
        posY = (cropSize - imgNaturalHeight * scale) / 2;
        
        updateCropImage();
        updateZoomLabel();
        cropModal.classList.add('visible');
      };
    }

    function closeCropModal() {
      cropModal.classList.remove('visible');
    }

    function updateCropImage() {
      cropImage.style.width = imgNaturalWidth * scale + 'px';
      cropImage.style.height = imgNaturalHeight * scale + 'px';
      cropImage.style.transform = `translate(${posX}px, ${posY}px)`;
    }

    function updateZoomLabel() {
      const percentage = Math.round((scale / minScale) * 100);
      zoomLabel.textContent = percentage + '%';
    }

    function constrainPosition() {
      const cropSize = 280;
      const imgWidth = imgNaturalWidth * scale;
      const imgHeight = imgNaturalHeight * scale;
      
      // Keep image covering the crop circle
      const minX = cropSize - imgWidth;
      const minY = cropSize - imgHeight;
      
      posX = Math.min(0, Math.max(minX, posX));
      posY = Math.min(0, Math.max(minY, posY));
    }

    function setScale(newScale, centerX = 140, centerY = 140) {
      const oldScale = scale;
      scale = Math.min(maxScale, Math.max(minScale, newScale));
      
      // Zoom toward center point
      const scaleRatio = scale / oldScale;
      posX = centerX - (centerX - posX) * scaleRatio;
      posY = centerY - (centerY - posY) * scaleRatio;
      
      constrainPosition();
      updateCropImage();
      updateZoomLabel();
    }

    // Zoom buttons
    zoomIn.addEventListener('click', () => setScale(scale * 1.2));
    zoomOut.addEventListener('click', () => setScale(scale / 1.2));

    // Mouse drag - attach to container instead of image for better hit detection
    cropContainer.addEventListener('mousedown', (e) => {
      // Ignore if clicking on overlay controls
      if (e.target.closest('.crop-zoom-controls')) return;
      
      e.preventDefault();
      isDragging = true;
      dragStartX = e.clientX;
      dragStartY = e.clientY;
      startPosX = posX;
      startPosY = posY;
      cropContainer.style.cursor = 'grabbing';
    });

    document.addEventListener('mousemove', (e) => {
      if (!isDragging) return;
      
      const deltaX = e.clientX - dragStartX;
      const deltaY = e.clientY - dragStartY;
      
      posX = startPosX + deltaX;
      posY = startPosY + deltaY;
      
      constrainPosition();
      updateCropImage();
    });

    document.addEventListener('mouseup', () => {
      if (isDragging) {
        isDragging = false;
        cropContainer.style.cursor = 'grab';
      }
    });

    // Mouse wheel zoom
    cropContainer.addEventListener('wheel', (e) => {
      e.preventDefault();
      const rect = cropContainer.getBoundingClientRect();
      const centerX = e.clientX - rect.left;
      const centerY = e.clientY - rect.top;
      
      const zoomFactor = e.deltaY > 0 ? 0.9 : 1.1;
      setScale(scale * zoomFactor, centerX, centerY);
    });

    // Touch drag - attach to container
    cropContainer.addEventListener('touchstart', (e) => {
      if (e.touches.length === 1) {
        isDragging = true;
        dragStartX = e.touches[0].clientX;
        dragStartY = e.touches[0].clientY;
        startPosX = posX;
        startPosY = posY;
      } else if (e.touches.length === 2) {
        isDragging = false;
        initialPinchDistance = getPinchDistance(e.touches);
        initialPinchScale = scale;
      }
    }, { passive: true });

    document.addEventListener('touchmove', (e) => {
      if (e.touches.length === 1 && isDragging) {
        const deltaX = e.touches[0].clientX - dragStartX;
        const deltaY = e.touches[0].clientY - dragStartY;
        
        posX = startPosX + deltaX;
        posY = startPosY + deltaY;
        
        constrainPosition();
        updateCropImage();
      } else if (e.touches.length === 2) {
        const currentDistance = getPinchDistance(e.touches);
        const pinchRatio = currentDistance / initialPinchDistance;
        setScale(initialPinchScale * pinchRatio);
      }
    }, { passive: true });

    document.addEventListener('touchend', () => {
      isDragging = false;
    });

    function getPinchDistance(touches) {
      const dx = touches[0].clientX - touches[1].clientX;
      const dy = touches[0].clientY - touches[1].clientY;
      return Math.sqrt(dx * dx + dy * dy);
    }

    // Cancel crop
    cropCancel.addEventListener('click', () => {
      closeCropModal();
      if (!croppedImageData) {
        profileInput.value = '';
        profileImage = null;
      }
    });

    // Confirm crop
    cropConfirm.addEventListener('click', () => {
      // Create canvas and crop
      const canvas = document.createElement('canvas');
      const ctx = canvas.getContext('2d');
      const cropSize = 280;
      const outputSize = 280;
      
      canvas.width = outputSize;
      canvas.height = outputSize;
      
      // Draw the cropped portion
      const sourceX = -posX / scale;
      const sourceY = -posY / scale;
      const sourceSize = cropSize / scale;
      
      ctx.drawImage(
        cropImage,
        sourceX, sourceY, sourceSize, sourceSize,
        0, 0, outputSize, outputSize
      );
      
      croppedImageData = canvas.toDataURL('image/jpeg', 0.9);
      
      // Update preview
      profilePreview.innerHTML = `<img src="${croppedImageData}" alt="Profile" />`;
      profilePreview.classList.add('has-image');
      profileUploadBtn.textContent = 'Change Picture';
      
      closeCropModal();
    });

    // ============ DOB HELPER (SHOW ON FOCUS) ============
    const dobInputs = [dobMonth, dobDay, dobYear];
    
    dobInputs.forEach(input => {
      input.addEventListener('focus', () => {
        dobHelper.classList.add('visible');
      });
      input.addEventListener('blur', () => {
        setTimeout(() => {
          const activeEl = document.activeElement;
          if (!dobInputs.includes(activeEl)) {
            dobHelper.classList.remove('visible');
          }
        }, 100);
      });
    });

    // ============ DOB AUTO-TAB & AGE CHECK ============
    function calculateAge(month, day, year) {
      const today = new Date();
      const birthDate = new Date(year, month - 1, day);
      let age = today.getFullYear() - birthDate.getFullYear();
      const monthDiff = today.getMonth() - birthDate.getMonth();
      
      if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birthDate.getDate())) {
        age--;
      }
      
      return age;
    }

    function checkAgeAndShowConsent() {
      const m = parseInt(dobMonth.value, 10);
      const d = parseInt(dobDay.value, 10);
      const y = parseInt(dobYear.value, 10);

      if (isNaN(m) || isNaN(d) || isNaN(y) || dobYear.value.length < 4) {
        parentConsentRow.classList.remove('visible');
        return;
      }

      if (m < 1 || m > 12 || d < 1 || d > 31 || y < 1900 || y > new Date().getFullYear()) {
        parentConsentRow.classList.remove('visible');
        return;
      }

      userAge = calculateAge(m, d, y);
      
      if (userAge >= 13 && userAge < 18) {
        isMinor = true;
        parentConsentRow.classList.add('visible');
      } else {
        isMinor = false;
        parentConsentRow.classList.remove('visible');
      }
    }

    function autoTab(current, next, maxLength) {
      current.addEventListener('input', (e) => {
        e.target.value = e.target.value.replace(/\D/g, '');
        
        if (e.target.value.length >= maxLength && next) {
          next.focus();
        }

        if (current === dobYear && e.target.value.length === 4) {
          checkAgeAndShowConsent();
        }
      });
    }

    autoTab(dobMonth, dobDay, 2);
    autoTab(dobDay, dobYear, 2);
    autoTab(dobYear, null, 4);

    dobMonth.addEventListener('blur', checkAgeAndShowConsent);
    dobDay.addEventListener('blur', checkAgeAndShowConsent);
    dobYear.addEventListener('blur', checkAgeAndShowConsent);

    // ============ LEGAL NAME HELPER (SHOW ON FOCUS) ============
    const legalNameInputs = [legalFirst, legalLast];
    
    legalNameInputs.forEach(input => {
      input.addEventListener('focus', () => {
        legalNameHelper.classList.add('visible');
      });
      input.addEventListener('blur', () => {
        setTimeout(() => {
          const activeEl = document.activeElement;
          if (!legalNameInputs.includes(activeEl)) {
            legalNameHelper.classList.remove('visible');
          }
        }, 100);
      });
    });

    // ============ FORMAT HELPERS ============
    stateInput.addEventListener('input', (e) => {
      e.target.value = e.target.value.toUpperCase().replace(/[^A-Z]/g, '');
    });

    zipInput.addEventListener('input', (e) => {
      e.target.value = e.target.value.replace(/\D/g, '');
    });

    // ============ PASSWORD LIVE VALIDATION ============
    passwordInput.addEventListener('input', () => {
      const val = passwordInput.value;
      
      ruleLength.classList.toggle('met', val.length >= 8);
      ruleUpper.classList.toggle('met', /[A-Z]/.test(val));
      ruleLower.classList.toggle('met', /[a-z]/.test(val));
      ruleNumber.classList.toggle('met', /[0-9]/.test(val));
    });

    // ============ CLEAR ERRORS ON INPUT ============
    displayNameInput.addEventListener('input', () => { displayNameError.textContent = ''; });
    dobMonth.addEventListener('input', () => { dobError.textContent = ''; });
    dobDay.addEventListener('input', () => { dobError.textContent = ''; });
    dobYear.addEventListener('input', () => { dobError.textContent = ''; });
    emailInput.addEventListener('input', () => { emailError.textContent = ''; });
    passwordInput.addEventListener('input', () => { passwordError.textContent = ''; });
    legalFirst.addEventListener('input', () => { legalNameError.textContent = ''; });
    legalLast.addEventListener('input', () => { legalNameError.textContent = ''; });
    streetInput.addEventListener('input', () => { addressError.textContent = ''; });
    cityInput.addEventListener('input', () => { addressError.textContent = ''; });
    stateInput.addEventListener('input', () => { addressError.textContent = ''; });
    zipInput.addEventListener('input', () => { addressError.textContent = ''; });
    termsCheckbox.addEventListener('change', () => { termsError.textContent = ''; });

    // ============ VALIDATION HELPERS ============
    function isValidEmail(email) {
      return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
    }

    function isValidPassword(password) {
      return (
        password.length >= 8 &&
        /[A-Z]/.test(password) &&
        /[a-z]/.test(password) &&
        /[0-9]/.test(password)
      );
    }

    function isValidDOB(month, day, year) {
      const m = parseInt(month, 10);
      const d = parseInt(day, 10);
      const y = parseInt(year, 10);
      
      if (isNaN(m) || isNaN(d) || isNaN(y)) return { valid: false, reason: 'incomplete' };
      if (m < 1 || m > 12) return { valid: false, reason: 'invalid' };
      if (d < 1 || d > 31) return { valid: false, reason: 'invalid' };
      if (y < 1900 || y > new Date().getFullYear()) return { valid: false, reason: 'invalid' };
      
      const testDate = new Date(y, m - 1, d);
      if (testDate.getMonth() !== m - 1) return { valid: false, reason: 'invalid' };
      
      const age = calculateAge(m, d, y);
      if (age < 13) return { valid: false, reason: 'underage' };
      
      return { valid: true, age: age };
    }

    // ============ FORM SUBMISSION ============
    form.addEventListener('submit', (e) => {
      e.preventDefault();
      
      let hasError = false;

      // Validate profile photo
      if (!croppedImageData) {
        profileError.textContent = 'Please add a profile picture.';
        hasError = true;
      }
      
      // Validate display name
      if (!displayNameInput.value.trim()) {
        displayNameError.textContent = 'Please enter your artist name.';
        hasError = true;
      }

      // Validate DOB
      const dobResult = isValidDOB(dobMonth.value, dobDay.value, dobYear.value);
      if (!dobResult.valid) {
        if (dobResult.reason === 'incomplete') {
          dobError.textContent = 'Please enter your complete date of birth.';
        } else if (dobResult.reason === 'underage') {
          dobError.textContent = 'You must be at least 13 years old to use Stickerbook.';
        } else {
          dobError.textContent = 'Please enter a valid date of birth.';
        }
        hasError = true;
      }

      // If minor, check parent consent
      if (isMinor && !parentConsentCheckbox.checked) {
        dobError.textContent = 'Please confirm your parent or guardian knows about this account.';
        hasError = true;
      }

      // Legal name
      if (!legalFirst.value.trim() || !legalLast.value.trim()) {
        legalNameError.textContent = 'Please enter your first and last name.';
        hasError = true;
      }

      // Address
      if (!streetInput.value.trim() || !cityInput.value.trim() || !stateInput.value.trim() || !zipInput.value.trim()) {
        addressError.textContent = 'Please enter your complete address.';
        hasError = true;
      } else if (zipInput.value.length !== 5) {
        addressError.textContent = 'Please enter a valid 5-digit ZIP code.';
        hasError = true;
      } else if (stateInput.value.length !== 2) {
        addressError.textContent = 'Please enter a valid 2-letter state code.';
        hasError = true;
      }
      
      // Validate email
      if (!emailInput.value.trim()) {
        emailError.textContent = 'Please enter your email address.';
        hasError = true;
      } else if (!isValidEmail(emailInput.value)) {
        emailError.textContent = 'Please enter a valid email address.';
        hasError = true;
      }
      
      // Validate password
      if (!passwordInput.value) {
        passwordError.textContent = 'Please create a password.';
        hasError = true;
      } else if (!isValidPassword(passwordInput.value)) {
        passwordError.textContent = 'Password doesn\'t meet all requirements.';
        hasError = true;
      }
      
      // Validate terms
      if (!termsCheckbox.checked) {
        termsError.textContent = 'You must agree to the terms to continue.';
        hasError = true;
      }
      
      if (hasError) return;
      
      // ============ SAVE DATA ============
      const creatorData = {
        type: 'creator',
        isMinor: isMinor,
        displayName: displayNameInput.value.trim(),
        dob: {
          month: dobMonth.value,
          day: dobDay.value,
          year: dobYear.value
        },
        legalName: {
          first: legalFirst.value.trim(),
          last: legalLast.value.trim()
        },
        address: {
          street: streetInput.value.trim(),
          apt: aptInput.value.trim(),
          city: cityInput.value.trim(),
          state: stateInput.value.trim().toUpperCase(),
          zip: zipInput.value.trim()
        },
        email: emailInput.value.trim()
      };
      
      localStorage.setItem('stickerbook_creator', JSON.stringify(creatorData));
      localStorage.setItem('stickerbook_user_name', creatorData.displayName);
      localStorage.setItem('stickerbook_is_minor', isMinor.toString());
      
      // Store profile image data
      if (croppedImageData) {
        localStorage.setItem('stickerbook_profile_image', croppedImageData);
      }
      
      // Navigate to creator studio
      window.location.href = 'creatorstudio.html';
    });
  </script>
</body>
</html>